(("undefined"!==typeof self?self:this)["webpackJsonpflow_builder"]=("undefined"!==typeof self?self:this)["webpackJsonpflow_builder"]||[]).push([[0],{"1e79":function(e,t,r){"use strict";var o=r("be07"),a=r.n(o);a.a},"404e":function(e,t,r){},"4ddf":function(e,t,r){},"510a":function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.flow.languages.length>0?r("div",{staticClass:"resource-editor"},[r("hr"),e.label?r("h4",[e._v(" "+e._s(e.label)+" ")]):e._e(),r("div",[r("b-tabs",e._l(e.flow.languages,(function(t){var o=t.id,a=t.label;return r("b-tab",{key:o,attrs:{title:e._f("trans")(a||"flow-builder.unknown-language")}},e._l(e.flow.supported_modes,(function(t,a){return r("div",{key:a,staticClass:"tab-content-style"},[r("header",{staticClass:"d-flex"},[e.iconsMap.get(t)?r("font-awesome-icon",{class:{"custom-icons":"fac"===e.iconsMap.get(t)[0],"library-icons":"fac"!==e.iconsMap.get(t)[0]},attrs:{icon:e.iconsMap.get(t)}}):e._e(),r("h6",{staticClass:"ml-1"},[e._v(e._s(e._f("trans")("flow-builder."+t.toLowerCase()+"-content")))])],1),e._l(e.discoverContentTypesFor(t),(function(a){return[a===e.SupportedContentType.TEXT?r("resource-variant-text-editor",{attrs:{"resource-id":e.resource.uuid,"resource-variant":e.findOrGenerateStubbedVariantOn(e.resource,{language_id:o,content_type:a,modes:[t]}),mode:t,"enable-autogen-button":!0}}):e._e(),a===e.SupportedContentType.AUDIO?r("div",[r("audio-library-selector",{attrs:{"audio-files":e.availableAudio,"lang-id":o,"resource-id":e.resource.uuid,"selected-audio-file":e.findOrGenerateStubbedVariantOn(e.resource,{language_id:o,content_type:a,modes:[t]}).value}}),e.can(["edit-content","send-call-to-records"],!0)&&!e.findOrGenerateStubbedVariantOn(e.resource,{language_id:o,content_type:a,modes:[t]}).value?r("phone-recorder",{attrs:{"recording-key":e.block.uuid+":"+o}}):e._e(),e.findAudioResourceVariantFor(e.resource,{language_id:o,content_type:a,modes:[t]})?e._e():[r("upload-monitor",{attrs:{"upload-key":e.block.uuid+":"+o}}),r("div",{staticClass:"d-flex mt-2"},[e.isEditable&&e.isFeatureAudioUploadEnabled?r("button",{directives:[{name:"flow-uploader",rawName:"v-flow-uploader",value:{target:e.route("trees.resumeableAudioUpload"),token:""+e.block.uuid+o,accept:"audio/*"},expression:"{\n                      target: route('trees.resumeableAudioUpload'),\n                      token: `${block.uuid}${languageId}`,\n                      accept: 'audio/*'}"}],staticClass:"btn btn-primary ivr-buttons",on:{filesSubmitted:function(t){return e.handleFilesSubmittedFor(e.block.uuid+":"+o,t)},fileSuccess:function(t){return e.handleFileSuccessFor(e.block.uuid+":"+o,o,t)}}},[r("font-awesome-icon",{staticClass:"fa-btn",attrs:{icon:["fac","upload"]}}),e._v(" "+e._s(e._f("trans")("flow-builder.upload-audio"))+" ")],1):e._e(),e.can(["edit-content","send-call-to-records"],!0)&&e.isFeatureAudioUploadEnabled?r("button",{staticClass:"btn btn-primary ivr-buttons ml-2",on:{click:function(t){return t.preventDefault(),e.triggerRecordViaPhoneFor(o)}}},[r("font-awesome-icon",{staticClass:"fa-btn",attrs:{icon:["fac","record-audio"]}}),e._v(" "+e._s(e._f("trans")("flow-builder.record-audio"))+" ")],1):e._e()])]],2):e._e()]}))],2)})),0)})),1)],1)]):e._e()},a=[],i=r("f3f3"),s=r("276c"),n=r("e954"),l=r("2c4c"),c=r("920b"),d=r("92a6"),u=r("fc11"),p=(r("99af"),r("e260"),r("4ec9"),r("d3b7"),r("3ca3"),r("ddb0"),r("a4d3"),r("e01a"),r("ac1f"),r("1276"),r("9ab4")),f=r("8bbf"),b=r.n(f),h=r("4bb5"),g=r("9300"),v=r("4a51"),m=r("cab2"),y=r("d39e"),C=(r("7db0"),r("ebc7")),w=r.n(C),O=r("2ef0"),S=r.n(O),j=r("2fe1"),E=function(e,t,r){e.dispatchEvent(S.a.extend(new Event(t,{bubbles:!0,cancelable:!0}),{data:r}))},x=function(e){Object(c["a"])(r,e);var t=Object(d["a"])(r);function r(){return Object(s["a"])(this,r),t.apply(this,arguments)}return r}(b.a);x=Object(p["__decorate"])([Object(j["b"])({directives:{"flow-uploader":{bind:function(e,t){var r=t.value,o=r.accept,a=r.target,i=r.token,s=new w.a({target:a,singleFile:!0,chunkSize:524288,query:{upload_token:i}});s.support&&(S.a.extend(e.style,{overflow:"hidden"}),s.assignBrowse(e),S.a.chain(e.children).find({tagName:"INPUT",type:"file"}).assign({accept:o}).value(),s.on("filesSubmitted",(function(t,r){return E(e,"filesSubmitted",{files:t,uploader:s})})),s.on("fileProgress",(function(t,r){return E(e,"fileProgress",{file:t,uploader:s})})),s.on("fileSuccess",(function(t,r){return E(e,"fileSuccess",{file:t,uploader:s,json:r})})),s.on("error",(function(t,r){return E(e,"fileSuccess",{file:r,uploader:s,message:t})})))},unbind:function(e,t){}}}})],x);var k,I=x,F=r("1b40"),A=r("393e"),U=r("bb40"),M=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"audio-library-selector"},[e.selectedAudioFile?r("audio-library-selection",{attrs:{"audio-file":e.selectedAudioFile,"lang-id":e.langId},on:{clear:e.clearSelection}}):[r("audio-library-search-field",{attrs:{"lang-id":e.langId,"audio-files":e.audioFiles},on:{select:e.selectAudioFile}})]],2)},R=[],P=r("2f62"),V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"audio-library-search-field dropdown"},[r("div",{staticClass:"input-group"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.rawQuery,expression:"rawQuery"}],staticClass:"form-control",attrs:{type:"text",placeholder:e._f("trans")("flow-builder.search-audio-library"),disabled:e.isEntireLibraryModeEnabled},domProps:{value:e.rawQuery},on:{focus:e.activate,blur:e.deactivate,input:[function(t){t.target.composing||(e.rawQuery=t.target.value)},e.resetPagination]}}),r("span",{staticClass:"input-group-append"},[r("button",{staticClass:"btn btn-primary dropdown-toggle",class:{active:e.isEntireLibraryModeEnabled},on:{click:function(t){return t.preventDefault(),e.toggleAudioLibrary.apply(null,arguments)}}},[r("i",{staticClass:"glyphicon glyphicon-search"})])])]),e.query||e.isAudioLibraryEmpty||e.isEntireLibraryModeEnabled?r("div",{staticClass:"dropdown-menu"},[e.isEntireLibraryModeEnabled?[r("a",{staticClass:"disabled dropdown-item",attrs:{href:"#"},on:{click:function(e){e.preventDefault()}}},[r("button",{staticClass:"close active",on:{click:e.toggleAudioLibrary}},[e._v("x ")]),r("i",{staticClass:"glyphicon glyphicon-info-sign"}),e._v(" "+e._s(e._f("trans")("flow-builder.showing-entire-audio-library"))+"… ")]),r("div",{staticClass:"dropdown-divider",attrs:{role:"separator"}})]:e._e(),e.isAudioLibraryEmpty?e._e():[e._l(e.search(e.query).slice(e.offset*e.limit,(e.offset+1)*e.limit),(function(t){return r("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(r){return r.preventDefault(),e.select(t)}}},[e._v(" "+e._s(t.description)+" ")])})),e.query.length>=3&&!e.search(e.query).length?r("a",{staticClass:"disabled dropdown-item",attrs:{href:"#"},on:{click:function(e){e.preventDefault()}}},[e._v(" "+e._s(e._f("trans")("flow-builder.no-audio-files-found-for-X"))+' "'),r("em",[e._v(e._s(e.query))]),e._v('". ')]):e._e(),e.query&&e.query.length<3?r("a",{staticClass:"disabled dropdown-item",attrs:{href:"#"},on:{click:function(e){e.preventDefault()}}},[e._v(" "+e._s(e._f("trans")("flow-builder.enter-at-least-three-chars"))+" ")]):e._e(),e.hasPrevious||e.hasNext?[r("div",{staticClass:"dropdown-divider",attrs:{role:"separator"}}),r("div",{staticClass:"pagers dropdown-item"},[r("a",{staticClass:"col-md-6",class:{disabled:!e.hasPrevious},attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.decrementPage.apply(null,arguments)}}},[r("i",{staticClass:"glyphicon glyphicon-chevron-left"}),e._v(" "+e._s(e._f("trans")("flow-builder.previous"))+" ")]),r("a",{staticClass:"col-md-6 text-right",class:{disabled:!e.hasNext},attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.incrementPage.apply(null,arguments)}}},[e._v(" "+e._s(e._f("trans")("flow-builder.next"))+" "),r("i",{staticClass:"glyphicon glyphicon-chevron-right"})])])]:e._e()],e.isAudioLibraryEmpty?r("a",{staticClass:"disabled dropdown-item",attrs:{href:"#"},on:{click:function(e){e.preventDefault()}}},[r("i",{staticClass:"glyphicon glyphicon-warning-sign"}),e._v(" "+e._s(e._f("trans")("flow-builder.audio-lib-empty-for-this-org"))+" ")]):e._e()],2):e._e()])},L=[],N=(r("841c"),r("ffe7")),T=r.n(N),$=r("f837"),D=r.n($),B={mixins:[D.a.mixin,v["b"]],props:["langId","audioFiles"],data:function(){return{isActive:!1,rawQuery:"",cache:{},isEntireLibraryModeEnabled:!1,offset:0,limit:10}},computed:{query:function(){return Object(O["trim"])(this.rawQuery)},isAudioLibraryEmpty:function(){return this.isActive&&!this.audioFiles.length},hasNext:function(){return this.search(this.query).length/(this.offset+1)>this.limit},hasPrevious:function(){return this.offset>0}},methods:{search:function(e){if(this.isEntireLibraryModeEnabled)return this.audioFiles;if(e.length<3)return[];if(console.debug("flow-builder.ResourceViewer.AudioLibrarySearchField","searching",e),e in this.cache)return console.debug("flow-builder.ResourceViewer.AudioLibrarySearchField","cache hit",e),this.cache[e];console.debug("flow-builder.ResourceViewer.AudioLibrarySearchField","cache miss",e);var t=["filename","description"];return this.cache[e]=new T.a(this.audioFiles,{keys:t}).search(e),this.cache[e]},incrementPage:function(){this.hasNext&&(this.offset+=1)},decrementPage:function(){this.hasPrevious&&(this.offset-=1)},resetPagination:function(){this.offset=0},toggleAudioLibrary:function(){this.isEntireLibraryModeEnabled=!this.isEntireLibraryModeEnabled,this.resetPagination()},select:function(e){this.$emit("select",{value:e,langId:this.langId})},activate:function(){this.isActive=!0},deactivate:function(){this.isActive=!1}}},q=B,K=(r("f837a"),r("2877")),G=Object(K["a"])(q,V,L,!1,null,"22499358",null),z=G.exports,Q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"well well-sm audio-library-selection",class:{"tree-audio-control-text-container-selectable":e.selectable,"tree-audio-control-text-container-selected":!e.selectable},attrs:{"data-audio-file-container-language":e.langId}},[r("button",{staticClass:"audio-library-selection-clear-selection btn-ghost pull-right",on:{click:function(t){return t.preventDefault(),e.clear.apply(null,arguments)}}},[r("i",{staticClass:"glyphicon glyphicon-remove"})]),r("div",{staticClass:"btn-group audio-library-selection-download-dropdown"},[e._m(0),r("ul",{staticClass:"dropdown-menu dropdown-menu-right"},[r("li",[r("a",{staticClass:"tree-block-audio-files-download-original",attrs:{href:e.audioFileUrl,target:"_blank"}},[e._v(e._s(e._f("trans")("flow-builder.original-file")))])])])]),r("p",{staticClass:"audio-file-description",attrs:{title:e.audioFileUrl}},[e._v(" "+e._s(e.audioFileUrl)+" ")]),r("div",{staticClass:"btn-toolbar"},[e.selectable?r("button",{staticClass:"btn btn-secondary btn-xs",on:{click:function(t){return t.preventDefault(),e.select.apply(null,arguments)}}},[r("i",{staticClass:"glyphicon glyphicon-ok"})]):e._e()])])},J=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"btn btn-ghost dropdown-toggle",attrs:{type:"button","data-toggle":"dropdown"}},[r("span",{staticClass:"glyphicon glyphicon-download-alt",attrs:{"aria-hidden":"true"}}),r("span",{staticClass:"caret"})])}],X=r("c1df"),Z=r.n(X),H={filters:{formatDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"llll";return e?Z.a.utc(e).format(t):""},fromNow:function(e,t){return Z.a.utc(e).fromNow(t)},formatDuration:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"seconds",r=arguments.length>2?arguments[2]:void 0,o=Z.a.locale();Z.a.locale("en");var a=Z.a.duration(e,t).humanize(r);return Z.a.locale(o),a},formatDurationLocalized:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"seconds",o=arguments.length>3?arguments[3]:void 0,a=Z.a.locale();Z.a.locale(t);var i=Z.a.duration(e,r).humanize(o);return Z.a.locale(a),i}}},W={mixins:[v["b"],H],props:["audioFile","selected","selectable","langId"],computed:{audioFileUrl:function(){return this.audioFile}},methods:{select:function(){this.$emit("select")},clear:function(){this.$emit("clear")}}},Y=W,ee=(r("79f2"),Object(K["a"])(Y,Q,J,!1,null,null,null)),te=ee.exports,re={components:{AudioLibrarySearchField:z,AudioLibrarySelection:te},props:["alternateSelections","selectedAudioFile","langId","audioFiles","isPlaying","audioPlayerUrl","resourceId"],computed:{selectable:function(){return!Object(O["isEmpty"])(this.alternateSelections)}},methods:Object(i["a"])(Object(i["a"])({},Object(P["a"])("flow",["resource_setOrCreateValueModeSpecific"])),{},{clearSelection:function(){this.resource_setOrCreateValueModeSpecific({resourceId:this.resourceId,filter:{language_id:this.langId,content_type:g["SupportedContentType"].AUDIO,modes:[g["SupportedMode"].IVR]},value:""})},selectAudioFile:function(e){var t=e.value,r=e.langId;this.resource_setOrCreateValueModeSpecific({resourceId:this.resourceId,filter:{language_id:r,content_type:g["SupportedContentType"].AUDIO,modes:[g["SupportedMode"].IVR]},value:t.description})}})},oe=re,ae=Object(K["a"])(oe,M,R,!1,null,null,null),ie=ae.exports,se=r("44e8"),ne=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isFeatureCallToRecordEnabled?r("div",{staticClass:"phone-recorder"},[r("phone-recording-recorder-selector",{attrs:{"is-modal-visible":e.isRecorderSelectorVisible},on:{input:e.handleRecorderSelectionChanged},model:{value:e.callConfig,callback:function(t){e.callConfig=t},expression:"callConfig"}})],1):e._e()},le=[],ce=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-modal",{staticClass:"phone-recording-recorder-selector",attrs:{size:"lg","no-close-on-backdrop":"","no-close-on-esc":"",title:e._f("trans")("flow-builder.select-a-caller-from-the-list-below"),visible:e.isModalVisible,"ok-title":e._f("trans")("flow-builder.call-this-phone-number"),"cancel-title":e._f("trans")("flow-builder.close")},on:{ok:e.handleModalClosed,cancel:e.handleModalCancelled,close:e.handleModalCancelled}},[r("div",{staticClass:"call-to-record-modal-table-container"},[r("table",{staticClass:"table table-striped"},[r("thead",[r("tr",[r("th",{staticClass:"recorder-selector-field"}),r("th",[e._v(e._s(e._f("trans")("flow-builder.name")))]),r("th",[e._v(e._s(e._f("trans")("flow-builder.phone-number")))])])]),r("tbody",{attrs:{id:"call-to-record-modal-list"}},e._l(e.recorders,(function(t){return r("tr",{staticClass:"call-to-record-item"},[r("td",{staticClass:"recorder-selector-field"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedRecorder,expression:"selectedRecorder"}],attrs:{id:"call-to-record-caller-"+t.id,type:"radio","x-name":"calltorecord_caller_select"},domProps:{value:t,checked:e._q(e.selectedRecorder,t)},on:{change:function(r){e.selectedRecorder=t}}})]),r("td",[r("label",{attrs:{for:"call-to-record-caller-"+t.id},on:{click:function(r){return e.setSelectedRecorder(t)}}},[e._v(e._s(t.name))])]),r("td",[r("label",{attrs:{for:"call-to-record-caller-"+t.id},on:{click:function(r){return e.setSelectedRecorder(t)}}},[e._v(e._s(t.phone))])])])})),0)]),r("h4",[e._v(e._s(e._f("trans")("flow-builder.add-a-description-to-this-recording")))]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.description,expression:"description"}],staticClass:"form-control",attrs:{type:"text",rows:"2",placeholder:e._f("trans")("flow-builder.optional-description")},domProps:{value:e.description},on:{input:function(t){t.target.composing||(e.description=t.target.value)}}}),r("h4",[e._v(e._s(e._f("trans")("flow-builder.add-a-new-recorder")))]),r("table",{staticClass:"table"},[r("tbody",[r("tr",[r("td",{staticClass:"recorder-selector-field"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedRecorder,expression:"selectedRecorder"}],attrs:{id:"new_recorder_radio",type:"radio",name:"calltorecord_caller_select"},domProps:{value:e.draft,checked:e._q(e.selectedRecorder,e.draft)},on:{change:function(t){e.selectedRecorder=e.draft}}})]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.draft.name,expression:"draft.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:e._f("trans")("flow-builder.name")},domProps:{value:e.draft.name},on:{click:e.selectNewRecorder,input:function(t){t.target.composing||e.$set(e.draft,"name",t.target.value)}}})]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.draft.phone,expression:"draft.phone"}],staticClass:"form-control",attrs:{type:"text",placeholder:e._f("trans")("flow-builder.phone-number")},domProps:{value:e.draft.phone},on:{click:e.selectNewRecorder,input:function(t){t.target.composing||e.$set(e.draft,"phone",t.target.value)}}})])])])])])])},de=[],ue=r("6aac"),pe={components:{BModal:ue["a"]},mixins:[v["b"]],props:{isModalVisible:Boolean},data:function(){return{selectedRecorder:null,description:null,draft:null}},created:function(){this.reset()},computed:Object(i["a"])({},Object(P["d"])({recorders:function(e){var t=e.audio.recording.recorders;return t}})),methods:{selectNewRecorder:function(){this.draft.isNew=!0,this.selectedRecorder=this.draft},setSelectedRecorder:function(e){this.selectedRecorder=e},reset:function(){this.draft={name:null,phone:null,isNew:!0},this.description=null,this.selectedRecorder=null},handleModalClosed:function(){var e=this.description,t=Object(O["clone"])(this.selectedRecorder);this.reset(),this.$emit("input",{value:t,recorder:t,description:e})},handleModalCancelled:function(){this.reset();var e=this.description,t=Object(O["clone"])(this.selectedRecorder);this.$emit("input",{value:t,recorder:t,description:e})}}},fe=pe,be=(r("e350"),Object(K["a"])(fe,ce,de,!1,null,"41756c06",null)),he=be.exports,ge={components:{PhoneRecordingRecorderSelector:he},props:["recordingKey"],data:function(){return{callConfig:null}},computed:Object(i["a"])(Object(i["a"])({},Object(P["d"])({isRecorderSelectorVisible:function(e){var t=e.audio.recording.isRecorderSelectorVisible;return t}})),Object(P["b"])(["isFeatureCallToRecordEnabled"])),methods:{handleRecorderSelectionChanged:function(){if(this.$store.commit("setAudioRecordingConfigVisibilityForSelectedBlock",{isVisible:!1}),this.callConfig.recorder){var e=Object(i["a"])({key:this.recordingKey,description:this.callConfig.description},this.callConfig.recorder);this.$store.dispatch("startAudioRecordingFor",e)}}}},ve=ge,me=Object(K["a"])(ve,ne,le,!1,null,null,null),_e=me.exports,ye=r("700c"),Ce=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"upload-monitor"},[e.hasProgress?r("div",{staticClass:"upload-monitor-progress"},[r("h6",[e._v(e._s(e._f("trans")("trees.uploading"))+"… "+e._s(e.upload.file.name))]),r("div",{staticClass:"progress"},[r("b-progress",{staticClass:"mb-3",attrs:{value:1*e.progress,"show-value":"",animated:""}})],1)]):e._e(),e.isFailure?r("p",{staticClass:"text-danger small"},[e._v(" "+e._s(e._f("trans")("trees.error-uploading-file-try-again"))+" "),e.upload.message?r("span",{staticClass:"details"},[e._v("("+e._s(e.upload.message)+")")]):e._e()]):e._e(),e.hasProgress?e._e():e._t("default")],2)},we=[],Oe=r("49f5"),Se=(r("159b"),r("bc3a")),je=r.n(Se),Ee={UPLOADING:-1,UNINITIALIZED:0,SUCCESS:1,FAILURE:2},xe=(k={},Object(u["a"])(k,Ee.UPLOADING,"uploading"),Object(u["a"])(k,Ee.UNINITIALIZED,"uninitialized"),Object(u["a"])(k,Ee.SUCCESS,"success"),Object(u["a"])(k,Ee.FAILURE,"failure"),{namespaced:!0,state:{uploadProgressByKey:{},errorMessageByKey:{},uploadsById:{},uploadIdsByKey:{}},mutations:{setErrorMessage:function(e,t){var r=e.errorMessageByKey,o=t.key,a=t.errorMessage;b.a.set(r,o,a)},setUploadProgress:function(e,t){var r=e.uploadProgressByKey,o=t.key,a=t.uploadProgress;b.a.set(r,o,a)},setUploadStatusFor:function(e,t){var r=e.uploadsById,o=e.uploadIdsByKey,a=t.file,i=t.key,s=t.status,n=t.progress,l=t.message,c=t.cancel,d=S.a.pick(a,["averageSpeed","currentSpeed","error","name","paused","relativePath","size","uniqueIdentifier"]);b.a.set(r,d.uniqueIdentifier,{key:i,status:s,progress:n,message:l,cancel:c,file:d}),b.a.set(o,i,d.uniqueIdentifier)}},actions:{uploadFile:function(e,t){var r=e.commit,o=t.key,a=t.uploadUrl,i=t.formDataFields,s=t.onSuccess,n=t.onError;if(!a)return r("setUploadProgress",{key:o,uploadProgress:null}),void n(new Error("url was ".concat(a)));var l=new FormData;S.a.forEach(i,(function(e,t){l.set(t,e)}));var c={onUploadProgress:function(e){r("setUploadProgress",{key:o,uploadProgress:Math.floor(100*e.loaded/e.total)})}};je.a.post(a,l,c).then((function(e){r("setUploadProgress",{key:o,uploadProgress:null}),s(e)})).catch((function(e){r("setUploadProgress",{key:o,uploadProgress:null}),n(e)}))},uploadFiles:function(e,t){var r=e.commit,o=(e.dispatch,e.state,t.key),a=t.files,i=t.uploader,s=function(e){return i.cancel()};a.forEach((function(e){return r("setUploadStatusFor",{file:e,key:o,progress:0,status:Ee.UNINITIALIZED,message:null,cancel:s})})),i.on("fileProgress",(function(e,t){console.debug("Upload in progress... ".concat(_.parseInt(100*e.progress()),"%")),r("setUploadStatusFor",{file:e,key:o,progress:e.progress(),status:Ee.UPLOADING,message:null,cancel:s})})),i.on("fileSuccess",(function(e,t){console.debug("Upload successful!"),r("setUploadStatusFor",{file:e,key:o,progress:1,status:Ee.SUCCESS,message:null,cancel:s})})),i.on("error",(function(e,t){var a=JSON.parse(e)||{},i=a.status_description;console.debug("Upload has error ".concat(i)),r("setUploadStatusFor",{file:t,key:o,status:Ee.FAILURE,message:i,cancel:s})})),i.upload(),console.debug("Upload in progress...")}}}),ke={components:{BProgress:Oe["a"]},mixins:[v["b"]],props:["uploadKey"],computed:Object(i["a"])(Object(i["a"])({},Object(P["d"])("multimediaUpload",["uploadsById","uploadIdsByKey"])),{},{upload:function(){return this.uploadsById[this.uploadIdsByKey[this.uploadKey]]},hasProgress:function(){return this.upload&&this.upload.status!==Ee.SUCCESS&&this.upload.status!==Ee.FAILURE},isFailure:function(){return this.upload&&this.upload.status===Ee.FAILURE},progress:function(){return 100*Object(O["get"])(this.upload,"progress",0)}}),created:function(){var e=this.$store,t={multimediaUpload:xe};Object(O["forEach"])(t,(function(t,r){return!e.hasModule(r)&&e.registerModule(r,t)}))}},Ie=ke,Fe=(r("9ea4"),Object(K["a"])(Ie,Ce,we,!1,null,null,null)),Ae=Fe.exports;b.a.use(ye["a"]);var Ue=Object(h["e"])("flow"),Me=Object(h["e"])("builder"),Re=function(e){Object(c["a"])(r,e);var t=Object(d["a"])(r);function r(){var e;Object(s["a"])(this,r);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),Object(u["a"])(Object(l["a"])(e),"block",void 0),Object(u["a"])(Object(l["a"])(e),"flow",void 0),Object(u["a"])(Object(l["a"])(e),"resource",void 0),Object(u["a"])(Object(l["a"])(e),"label",void 0),Object(u["a"])(Object(l["a"])(e),"discoverContentTypesFor",A["b"]),Object(u["a"])(Object(l["a"])(e),"findOrGenerateStubbedVariantOn",A["c"]),Object(u["a"])(Object(l["a"])(e),"findResourceVariantOverModesOn",A["d"]),Object(u["a"])(Object(l["a"])(e),"SupportedMode",g["SupportedMode"]),Object(u["a"])(Object(l["a"])(e),"SupportedContentType",g["SupportedContentType"]),Object(u["a"])(Object(l["a"])(e),"iconsMap",new Map([[g["SupportedMode"].SMS,["far","envelope"]],[g["SupportedMode"].TEXT,["fac","text"]],[g["SupportedMode"].USSD,["fac","ussd"]],[g["SupportedMode"].IVR,["fac","audio"]],[g["SupportedMode"].RICH_MESSAGING,["far","comment-dots"]],[g["SupportedMode"].OFFLINE,["fas","mobile-alt"]]])),Object(u["a"])(Object(l["a"])(e),"availableAudio",void 0),Object(u["a"])(Object(l["a"])(e),"isFeatureAudioUploadEnabled",void 0),Object(u["a"])(Object(l["a"])(e),"pushAudioIntoLibrary",void 0),Object(u["a"])(Object(l["a"])(e),"resource_setOrCreateValueModeSpecific",void 0),Object(u["a"])(Object(l["a"])(e),"isEditable",void 0),e}return Object(n["a"])(r,[{key:"triggerRecordViaPhoneFor",value:function(e){this.$store.commit("setAudioRecordingConfigVisibilityForSelectedBlock",{langId:e,isVisible:!0})}},{key:"handleFilesSubmittedFor",value:function(e,t){var r=t.data;console.debug("call handleFilesSubmittedFor"),this.$store.dispatch("multimediaUpload/uploadFiles",Object(i["a"])(Object(i["a"])({},r),{},{key:e}))}},{key:"handleFileSuccessFor",value:function(e,t,r){var o=r.data.json,a=JSON.parse(o),i=a.audio_file_id,s=a.audio_uuid,n=a.created_at.date,l=a.description,c=a.duration_seconds,d=l.split(".")[l.split(".").length-1],u={id:i,filename:s,description:l,language_id:t,duration_seconds:c,original_extension:d,created_at:n};this.resource_setOrCreateValueModeSpecific({resourceId:this.resource.uuid,filter:{language_id:t,content_type:g["SupportedContentType"].AUDIO,modes:[g["SupportedMode"].IVR]},value:l}),r.target.blur(),this.pushAudioIntoLibrary(u)}},{key:"findAudioResourceVariantFor",value:function(e,t){try{return Object(A["d"])(e,t).value}catch(r){if(!(r instanceof se["a"]))throw r;return null}}}]),r}(Object(j["c"])(I,m["a"],y["a"],v["a"]));Object(p["__decorate"])([Object(F["b"])({required:!0})],Re.prototype,"block",void 0),Object(p["__decorate"])([Object(F["b"])({required:!0})],Re.prototype,"flow",void 0),Object(p["__decorate"])([Object(F["b"])()],Re.prototype,"resource",void 0),Object(p["__decorate"])([Object(F["b"])()],Re.prototype,"label",void 0),Object(p["__decorate"])([h["b"]],Re.prototype,"availableAudio",void 0),Object(p["__decorate"])([h["b"]],Re.prototype,"isFeatureAudioUploadEnabled",void 0),Object(p["__decorate"])([h["c"]],Re.prototype,"pushAudioIntoLibrary",void 0),Object(p["__decorate"])([Ue.Action],Re.prototype,"resource_setOrCreateValueModeSpecific",void 0),Object(p["__decorate"])([Me.Getter],Re.prototype,"isEditable",void 0),Re=Object(p["__decorate"])([Object(F["a"])({components:{AudioLibrarySelector:ie,ResourceVariantTextEditor:U["a"],UploadMonitor:Ae,PhoneRecorder:_e}})],Re);var Pe=Re,Ve=Pe,Le=(r("c1dfb"),Object(K["a"])(Ve,o,a,!1,null,"60c13a2a",null));t["a"]=Le.exports},"726f":function(e,t,r){},"79f2":function(e,t,r){"use strict";var o=r("eef5"),a=r.n(o);a.a},"884b":function(e,t,r){},"9ea4":function(e,t,r){"use strict";var o=r("884b"),a=r.n(o);a.a},bb40:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"resource-variant-text-editor"},[r("div",{staticClass:"content-editor",class:{"content-editor-selected":!!e.content}},[r("div",{staticClass:"input-group"},[e.label?r("div",{staticClass:"input-group-prepend"},[r("span",{staticClass:"input-group-text"},[e._v(e._s(e.label))])]):e._e(),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"},{name:"focus",rawName:"v-focus",value:e.isSelected,expression:"isSelected"}],ref:"input",staticClass:"form-control",attrs:{placeholder:e._f("trans")(e.placeholder||"flow-builder.enter-"+e.resourceVariant.content_type.toString().toLowerCase()+"-content"),rows:e.rows},domProps:{value:e.content},on:{focus:e.select,blur:e.deselect,input:function(t){t.target.composing||(e.content=t.target.value)}}})])]),r("div",{staticClass:"content-toolbar"},[e.isEditable?r("span",{staticClass:"text-muted transition-all",class:{invisible:!e.characterCounter.count}},[e._v(" "+e._s(e.characterCounter.count)+" characters "),"sms"===e.mode&&e.characterCounter.pages>1?[e._v(" ("+e._s(e.characterCounter.pages)+" "+e._s(e.characterCounter.hasUnicode?"unicode pages":"pages")+") ")]:e._e()],2):e._e(),e.doesContentContainExpression?r("a",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top.html",value:"<p>"+e.trans("flow-builder.youre-using-floip-expressions")+"</p>\n                     <p>\n                       <strong>"+e.trans("flow-builder.pro-tip")+":</strong>\n                       "+e.trans("flow-builder.floip-expressions-escape-with-double-at-symbol")+"\n                     </p>",expression:"`<p>${trans('flow-builder.youre-using-floip-expressions')}</p>\n                     <p>\n                       <strong>${trans('flow-builder.pro-tip')}:</strong>\n                       ${trans('flow-builder.floip-expressions-escape-with-double-at-symbol')}\n                     </p>`",modifiers:{hover:!0,top:!0,html:!0}}],attrs:{href:"https://floip.gitbooks.io/flow-specification/content/fundamentals/expressions.html",target:"_blank"}},[r("kbd",{staticStyle:{"margin-left":"1em"}},[r("i",{staticClass:"glyphicon glyphicon-console"}),e.doesContentContainExpressionError?r("i",{staticClass:"glyphicon glyphicon glyphicon-remove-sign text-danger"}):r("i",{staticClass:"glyphicon glyphicon-ok-sign text-success"})])]):e._e(),e.doesContentContainExpressionError?r("div",{staticClass:"alert alert-danger",staticStyle:{"margin-top":"0.5em"}},[r("p",[r("i",{staticClass:"glyphicon glyphicon-remove-sign"}),r("strong",[r("a",{attrs:{href:"https://floip.gitbooks.io/flow-specification/content/fundamentals/expressions.html",target:"_blank"}},[e._v("FLOIP Expression")]),e._v(" "+e._s(e._f("trans")("flow-builder.error-found"))+" ")])]),r("p",[r("em",[e._v(" "+e._s(e.contentExpressionAST.message)+" ("),1!==e.contentExpressionAST.location.start.line?r("span",[e._v(e._s(e._f("trans")("flow-builder.on-line"))+" "+e._s(e.contentExpressionAST.location.start.line)+", ")]):e._e(),e._v(e._s(e._f("trans")("flow-builder.at-character"))+" "+e._s(e.contentExpressionAST.location.start.column)+") ")])])]):e._e()])])},a=[],i=r("f3f3"),s=(r("a9e3"),r("b0c0"),r("8bbf")),n=r.n(s),l=r("4a51"),c=r("14d3"),d=r("2ef0"),u=r("f837"),p=r.n(u),f=r("2f62"),b=r("b4ae");n.a.component("BTooltip",b["a"]);var h={components:{},mixins:[l["b"],p.a.mixin],props:{isEditable:Boolean,label:{type:String,default:null},placeholder:{type:String,default:null},resourceId:{type:String,default:null},resourceVariant:{type:Object,default:null},mode:{type:String,default:null},enableAutogenButton:{type:Boolean,default:!0},rows:{type:Number,default:2}},data:function(){return{isSelected:!1}},computed:{content:{get:function(){return this.resourceVariant.value},set:function(e){var t=this.resourceId,r=this.mode,o=this.resourceVariant,a=o.language_id,i=o.content_type;this.$emit("beforeResourceVariantChanged",{variant:this.resourceVariant,resourceId:t}),this.resource_setOrCreateValueModeSpecific({resourceId:t,filter:{language_id:a,content_type:i,modes:[r]},value:e}),this.$emit("afterResourceVariantChanged",{variant:this.resourceVariant,resourceId:t})}},contentExpressionAST:function(){var e=[];try{e=Object(c["parse"])(this.content)}catch(r){if(r instanceof SyntaxError||"SyntaxError"===r.name)return r}var t=Object(d["some"])(e,d["isObject"]);return t?e:null},doesContentContainExpression:function(){return!!this.contentExpressionAST},doesContentContainExpressionError:function(){return!!(this.contentExpressionAST instanceof Error)},characterCounter:function(){var e=!/^[\x00-\x7F]*$/.test(this.content),t=this.content.length;return console.debug("BlockTextContentEditorForLangAndType","characterCounter",{hasUnicode:e,count:t}),{hasUnicode:e,count:t,pages:e?Math.ceil(t/70):Math.ceil(t/160)}}},methods:Object(i["a"])(Object(i["a"])({},Object(f["a"])("flow",["resource_setOrCreateValueModeSpecific"])),{},{select:function(){this.isSelected=!0},deselect:function(){this.isSelected=!1}})},g=h,v=(r("1e79"),r("2877")),m=Object(v["a"])(g,o,a,!1,null,"0ce279b0",null);t["a"]=m.exports},be07:function(e,t,r){},c1dfb:function(e,t,r){"use strict";var o=r("4ddf"),a=r.n(o);a.a},e350:function(e,t,r){"use strict";var o=r("404e"),a=r.n(o);a.a},eef5:function(e,t,r){},f837a:function(e,t,r){"use strict";var o=r("726f"),a=r.n(o);a.a}}]);
//# sourceMappingURL=flow-builder.umd.min.0.js.map