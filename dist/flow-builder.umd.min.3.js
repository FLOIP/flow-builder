(("undefined"!==typeof self?self:this)["webpackJsonpflow_builder"]=("undefined"!==typeof self?self:this)["webpackJsonpflow_builder"]||[]).push([[3],{"5aa7":function(e,t,o){"use strict";var c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"choices-builder form-group"},[o("h4",[e._v(e._s(e._f("trans")("flow-builder.choices")))]),e._l(e.choiceResourcesOrderedByResourcesList,(function(t,c){return[o("resource-variant-text-editor",{key:t.uuid,ref:"choices",refInFor:!0,staticClass:"choices-builder-item",attrs:{label:(c+1).toString(),rows:1,placeholder:"Enter choice...","resource-id":t.uuid,"resource-variant":t.values[0],mode:e.SupportedMode.TEXT},on:{afterResourceVariantChanged:function(o){return e.handleExistingResourceVariantChangedFor(t.uuid,c,t)}}})]})),e.draftResource?o("resource-variant-text-editor",{ref:"draftChoice",staticClass:"choices-builder-item",attrs:{label:(e.choiceResourcesOrderedByResourcesList.length+1).toString(),rows:1,placeholder:"Enter choice...","resource-id":e.draftResource.uuid,"resource-variant":e.findOrGenerateStubbedVariantOn(e.draftResource,{language_id:e.activeFlow.languages[0].id,content_type:e.SupportedContentType.TEXT,modes:[e.SupportedMode.TEXT]}),mode:e.SupportedMode.TEXT},on:{beforeResourceVariantChanged:e.addDraftResourceToChoices,afterResourceVariantChanged:function(t){return e.rewriteChoiceKeyFor({resourceId:e.draftResource.uuid,blockId:e.block.uuid})}}}):e._e()],2)},r=[],i=o("c964"),a=o("276c"),n=o("e954"),s=o("2c4c"),u=o("920b"),d=o("92a6"),l=o("fc11"),b=(o("96cf"),o("99af"),o("07ac"),o("d3b7"),o("ddb0"),o("9ab4")),f=o("2ef0"),h=o("393e"),p=o("1b40"),O=o("2fe1"),j=o("4a51"),v=o("9300"),k=o("4bb5"),m=o("bb40"),g=o("ecef"),_=o("31aa"),y=Object(k["e"])("flow"),w=Object(k["e"])("flow/".concat(g["a"])),C=function(e){Object(u["a"])(o,e);var t=Object(d["a"])(o);function o(){var e;Object(a["a"])(this,o);for(var c=arguments.length,r=new Array(c),i=0;i<c;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(l["a"])(Object(s["a"])(e),"block",void 0),Object(l["a"])(Object(s["a"])(e),"draftResource",null),Object(l["a"])(Object(s["a"])(e),"SupportedContentType",v["SupportedContentType"]),Object(l["a"])(Object(s["a"])(e),"SupportedMode",v["SupportedMode"]),Object(l["a"])(Object(s["a"])(e),"findOrGenerateStubbedVariantOn",h["c"]),Object(l["a"])(Object(s["a"])(e),"resources",void 0),Object(l["a"])(Object(s["a"])(e),"resourcesByUuid",void 0),Object(l["a"])(Object(s["a"])(e),"activeFlow",void 0),Object(l["a"])(Object(s["a"])(e),"resource_add",void 0),Object(l["a"])(Object(s["a"])(e),"resource_createWith",void 0),Object(l["a"])(Object(s["a"])(e),"deleteChoiceByResourceIdFrom",void 0),Object(l["a"])(Object(s["a"])(e),"rewriteChoiceKeyFor",void 0),Object(l["a"])(Object(s["a"])(e),"addChoiceByResourceIdTo",void 0),e}return Object(n["a"])(o,[{key:"choiceResourcesOrderedByResourcesList",get:function(){var e=Object.values(this.block.config.choices);return Object(f["intersectionWith"])(this.resources,e,(function(e,t){return e.uuid===t}))}},{key:"created",value:function(){this.generateDraftResource()}},{key:"generateDraftResource",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,(new _["IdGeneratorUuidV4"]).generate();case 3:return e.t1=e.sent,e.t2={uuid:e.t1},e.t3={props:e.t2},e.next=8,e.t0.resource_createWith.call(e.t0,e.t3);case 8:this.draftResource=e.sent;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addDraftResourceToChoices",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=this.draftResource){e.next=3;break}return console.warn("interaction-designer/block-editors/ChoicesBuilder","Unable to add absent draft resource to block choices.",{block:this.block}),e.abrupt("return");case 3:return this.resource_add({resource:this.draftResource}),this.addChoiceByResourceIdTo({blockId:this.block.uuid,resourceId:this.draftResource.uuid}),this.$nextTick((function(){return t.focusInputElFor(Object(f["last"])(t.$refs.choices))})),e.next=8,this.generateDraftResource();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"focusInputElFor",value:function(e){null===e||void 0===e||e.$refs.input.focus()}},{key:"handleExistingResourceVariantChangedFor",value:function(e,t,o){var c=t===this.choiceResourcesOrderedByResourcesList.length-1,r=Object(f["isEmpty"])(Object(f["get"])(o.values[0],"value"));if(c&&r)return this.deleteChoiceByResourceIdFrom({blockId:this.block.uuid,resourceId:e}),void this.focusInputElFor(this.$refs.draftChoice);this.rewriteChoiceKeyFor({resourceId:e,blockId:this.block.uuid}),this.$emit("choiceChanged",{resourceId:e,choiceIndex:t,resource:o})}}]),o}(Object(O["c"])(j["a"]));Object(b["__decorate"])([Object(p["b"])()],C.prototype,"block",void 0),Object(b["__decorate"])([y.State],C.prototype,"resources",void 0),Object(b["__decorate"])([y.Getter],C.prototype,"resourcesByUuid",void 0),Object(b["__decorate"])([y.Getter],C.prototype,"activeFlow",void 0),Object(b["__decorate"])([y.Mutation],C.prototype,"resource_add",void 0),Object(b["__decorate"])([y.Action],C.prototype,"resource_createWith",void 0),Object(b["__decorate"])([w.Action],C.prototype,"deleteChoiceByResourceIdFrom",void 0),Object(b["__decorate"])([w.Action],C.prototype,"rewriteChoiceKeyFor",void 0),Object(b["__decorate"])([w.Action],C.prototype,"addChoiceByResourceIdTo",void 0),C=Object(b["__decorate"])([Object(p["a"])({components:{ResourceVariantTextEditor:m["a"]}})],C);var x=C,R=x,E=o("2877"),B=Object(E["a"])(R,c,r,!1,null,null,null);t["a"]=B.exports},"5c47":function(e,t,o){"use strict";o.r(t),o.d(t,"MobilePrimitives_SelectOneResponseBlock",(function(){return V})),o.d(t,"install",(function(){return W}));var c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"mobile-primitive-select-one-response-block"},[o("h3",{staticClass:"block-editor-header"},[e._v(" "+e._s(e._f("trans")("flow-builder."+e.block.type))+" ")]),o("fieldset",{attrs:{disabled:!e.isEditable}},[o("block-label-editor",{attrs:{block:e.block},on:{gearClicked:function(t){e.showSemanticLabel=!e.showSemanticLabel}}}),e.showSemanticLabel?o("block-semantic-label-editor",{attrs:{block:e.block}}):e._e(),o("block-name-editor",{attrs:{block:e.block}}),o("hr"),o("choices-builder",{attrs:{block:e.block},on:{choiceChanged:e.handleChoiceChanged}}),o("block-output-branching-config",{attrs:{block:e.block,"has-exit-per-choice":!0,"label-class":""},on:{branchingTypeChanged:function(t){return e.reflowExitsWhenSwitchingToBranchingTypeNotUnified()}}}),o("div",{staticClass:"prompt-resource"},[e.promptResource?o("resource-editor",{attrs:{label:e._f("trans")("flow-builder.prompt"),resource:e.promptResource,block:e.block,flow:e.flow}}):e._e()],1),e._t("extras"),o("categorization",{attrs:{block:e.block}}),o("generic-contact-property-editor",{attrs:{block:e.block}}),o("hr"),o("first-block-editor-button",{attrs:{flow:e.flow,"block-id":e.block.uuid}})],2),o("block-id",{attrs:{block:e.block}})],1)},r=[],i=o("276c"),a=o("e954"),n=o("2c4c"),s=o("920b"),u=o("92a6"),d=o("fc11"),l=(o("99af"),o("9ab4")),b=o("9300"),f=o("4bb5"),h=o("1b40"),p=o("2ef0"),O=o("ecef"),j=o("4a51"),v=o("8619"),k=o("af98"),m=o("2fe1"),g=o("bb40"),_=o("393e"),y=o("5aa7"),w=o("18b0"),C=o("f04e"),x=o("3411"),R=o("1b4e"),E=o("70f0"),B=o("192b"),I=o("510a"),T=o("792f"),F=o("b4ec"),S=Object(f["e"])("flow"),U=Object(f["e"])("flow/".concat(O["a"])),L=Object(f["e"])("builder"),V=function(e){Object(s["a"])(o,e);var t=Object(u["a"])(o);function o(){var e;Object(i["a"])(this,o);for(var c=arguments.length,r=new Array(c),a=0;a<c;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),Object(d["a"])(Object(n["a"])(e),"block",void 0),Object(d["a"])(Object(n["a"])(e),"flow",void 0),Object(d["a"])(Object(n["a"])(e),"showSemanticLabel",!1),Object(d["a"])(Object(n["a"])(e),"SupportedMode",b["SupportedMode"]),Object(d["a"])(Object(n["a"])(e),"findOrGenerateStubbedVariantOn",_["c"]),Object(d["a"])(Object(n["a"])(e),"resourcesByUuid",void 0),Object(d["a"])(Object(n["a"])(e),"block_createBlockExitWith",void 0),Object(d["a"])(Object(n["a"])(e),"block_convertExitFormationToUnified",void 0),Object(d["a"])(Object(n["a"])(e),"reflowExitsFromChoices",void 0),Object(d["a"])(Object(n["a"])(e),"handleBranchingTypeChangedToUnified",void 0),Object(d["a"])(Object(n["a"])(e),"isEditable",void 0),e}return Object(a["a"])(o,[{key:"promptResource",get:function(){return this.resourcesByUuid[this.block.config.prompt]}},{key:"handleChoiceChanged",value:function(){var e=this.block,t=e.uuid,o=e.vendor_metadata,c=w["b"].EXIT_PER_CHOICE,r=w["b"].UNIFIED;o.io_viamo.branchingType===r&&this.handleBranchingTypeChangedToUnified({block:this.block}),o.io_viamo.branchingType===c&&this.reflowExitsFromChoices({blockId:t})}},{key:"reflowExitsWhenSwitchingToBranchingTypeNotUnified",value:function(){var e=this.block,t=e.uuid,o=e.vendor_metadata,c=w["b"].EXIT_PER_CHOICE,r=w["b"].ADVANCED,i=Object(p["includes"])([c,r],o.io_viamo.branchingType);i?this.reflowExitsFromChoices({blockId:t}):this.handleBranchingTypeChangedToUnified({block:this.block})}}]),o}(Object(m["c"])(j["a"]));Object(l["__decorate"])([Object(h["b"])()],V.prototype,"block",void 0),Object(l["__decorate"])([Object(h["b"])()],V.prototype,"flow",void 0),Object(l["__decorate"])([S.Getter],V.prototype,"resourcesByUuid",void 0),Object(l["__decorate"])([S.Action],V.prototype,"block_createBlockExitWith",void 0),Object(l["__decorate"])([S.Action],V.prototype,"block_convertExitFormationToUnified",void 0),Object(l["__decorate"])([U.Action],V.prototype,"reflowExitsFromChoices",void 0),Object(l["__decorate"])([U.Action],V.prototype,"handleBranchingTypeChangedToUnified",void 0),Object(l["__decorate"])([L.Getter],V.prototype,"isEditable",void 0),V=Object(l["__decorate"])([Object(h["a"])({components:{GenericContactPropertyEditor:F["a"],ResourceVariantTextEditor:g["a"],BlockExitSemanticLabelEditor:E["a"],BlockId:T["a"],BlockLabelEditor:x["a"],BlockNameEditor:C["a"],BlockOutputBranchingConfig:w["c"],BlockSemanticLabelEditor:R["a"],ChoicesBuilder:y["a"],FirstBlockEditorButton:B["a"],ResourceEditor:I["a"],Categorization:v["a"]}})],V);var G=V,W=Object(k["d"])(O["a"],O["c"]),A=G,M=o("2877"),D=Object(M["a"])(A,c,r,!1,null,null,null);t["default"]=D.exports},"70f0":function(e,t,o){"use strict";var c=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("text-editor",{attrs:{"is-editable":e.isEditable,label:e._f("trans")("flow-builder.block-exit-semantic-label"),placeholder:e._f("trans")("flow-builder.enter-block-exit-semantic-label")},model:{value:e.semanticLabel,callback:function(t){e.semanticLabel=t},expression:"semanticLabel"}})],1)},r=[],i=o("f3f3"),a=o("2f62"),n=o("d883"),s=o("4a51"),u={components:{TextEditor:n["a"]},mixins:[s["b"]],props:{isEditable:{default:!0,type:Boolean},exit:{type:Object,required:!0}},computed:{semanticLabel:{get:function(){return this.exit.semantic_label},set:function(e){this.exit.semantic_label=e,this.$emit("commitSemanticLabel",e)}}},methods:Object(i["a"])({},Object(a["c"])("flow",["block_setExitSemanticLabel"]))},d=u,l=o("2877"),b=Object(l["a"])(d,c,r,!1,null,null,null);t["a"]=b.exports},ecef:function(e,t,o){"use strict";o.d(t,"a",(function(){return l})),o.d(t,"f",(function(){return b})),o.d(t,"d",(function(){return f})),o.d(t,"e",(function(){return h})),o.d(t,"b",(function(){return p}));var c=o("d0ff"),r=o("c964"),i=(o("96cf"),o("e260"),o("d3b7"),o("ddb0"),o("99af"),o("b64b"),o("fb6a"),o("e6cf"),o("3ca3"),o("d81d"),o("cca6"),o("a434"),o("a15b"),o("9300")),a=o("31aa"),n=o("8bbf"),s=o.n(n),u=o("2ef0"),d=o("85b2"),l="MobilePrimitives.SelectOneResponse",b=function(){return{}},f={},h={},p={rewriteChoiceKeyFor:function(e,t){var o=e.rootGetters,c=e.dispatch,r=t.resourceId,a=t.blockId,n=Object(i["findBlockWith"])(a,o["flow/activeFlow"]),s=o["flow/resourcesByUuid"][r];if(null==s)throw new i["ValidationException"]("Unable to find resource for choice: ".concat(r));var d=String(Object(u["findKey"])(n.config.choices,(function(e){return e===r})));n.config.choices=Object(u["omit"])(n.config.choices,d),c("addChoiceByResourceIdTo",{blockId:a,resourceId:r})},addChoiceByResourceIdTo:function(e,t){var o=e.rootGetters,c=t.blockId,r=t.resourceId,a=Object(i["findBlockWith"])(c,o["flow/activeFlow"]),n=o["flow/resourcesByUuid"][r];if(null==n)throw new i["ValidationException"]("Unable to find resource for choice: ".concat(r));var d=Object(u["snakeCase"])(Object(u["get"])(n.values[0],"value"))||n.uuid,l=d in a.config.choices,b=l?"-".concat(n.uuid):"";s.a.set(a.config.choices,"".concat(d).concat(b),n.uuid)},deleteChoiceByResourceIdFrom:function(e,t){var o=e.rootGetters,c=t.blockId,r=t.resourceId,a=Object(i["findBlockWith"])(c,o["flow/activeFlow"]),n=String(Object(u["findKey"])(a.config.choices,(function(e){return e===r})));s.a.delete(a.config.choices,n)},reflowExitsFromChoices:function(e,t){return Object(r["a"])(regeneratorRuntime.mark((function o(){var n,s,u,d,l,b,f,h;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n=e.dispatch,s=e.rootGetters,u=t.blockId,d=Object(i["findBlockWith"])(u,s["flow/activeFlow"]),l=d.config.choices,b=d.exits,f=Object.keys(l),h=b.slice(0,-1),o.next=8,Promise.all(f.map(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,o){var c,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=h[o]){e.next=8;break}return e.next=3,(new a["IdGeneratorUuidV4"]).generate();case 3:return c=e.sent,e.next=6,n("flow/block_createBlockExitWith",{props:{uuid:c}},{root:!0});case 6:r=e.sent,h.push(r);case 8:Object.assign(h[o],{name:t,test:'block.value = "'.concat(t,'"')});case 9:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}()));case 8:b.splice.apply(b,[0,b.length-1].concat(Object(c["a"])(h)));case 9:case"end":return o.stop()}}),o)})))()},createWith:function(e,t){return Object(r["a"])(regeneratorRuntime.mark((function o(){var c,r,i,n;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return c=e.dispatch,r=t.props,o.next=4,c("flow/flow_addBlankResourceForEnabledModesAndLangs",null,{root:!0});case 4:return i=o.sent,o.t0=c,o.next=8,(new a["IdGeneratorUuidV4"]).generate();case 8:return o.t1=o.sent,o.t2={uuid:o.t1},o.t3={props:o.t2},o.t4={root:!0},o.next=14,(0,o.t0)("flow/block_createBlockDefaultExitWith",o.t3,o.t4);case 14:return o.t5=o.sent,n=[o.t5],o.abrupt("return",Object(u["defaultsDeep"])(r,{type:l,name:"",label:"",semantic_label:"",config:{prompt:i.uuid,choices:{}},exits:n,tags:[],vendor_metadata:{}}));case 17:case"end":return o.stop()}}),o)})))()},handleBranchingTypeChangedToUnified:function(e,t){var o=e.dispatch,c=t.block;o("flow/block_convertExitFormationToUnified",{blockId:c.uuid,test:O(c)},{root:!0})},validate:function(e,t){e.rootGetters;var o=t.block,c=t.schemaVersion;return Object(d["e"])({block:o,schemaVersion:c})}};function O(e){var t=Object.keys(e.config.choices);return 0===t.length?(console.warn("Choices are empty for SelectOneBlock, providing `true` by default"),"true"):"OR(".concat(Object(u["map"])(t,(function(e){return'block.value = "'.concat(e,'"')})).join(","),")")}t["c"]={namespaced:!0,state:b,getters:f,mutations:h,actions:p}}}]);
//# sourceMappingURL=flow-builder.umd.min.3.js.map